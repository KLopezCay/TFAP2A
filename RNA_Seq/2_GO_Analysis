# ClusterProfiler for gene ontology and network analysis of differentially expressed genes
# Adapted from http://yulab-smu.top/clusterProfiler-book/chapter12.html
# Used for Go analysis and network clustering of bulk RNA seq DE genes of WK

library(clusterProfiler)
library(magrittr)
library(DOSE)
library(AnnotationHub)
library(enrichplot)
library(ggplot2)
library(org.Mm.eg.db)
library(pathview)
library(GOSemSim)
library(RColorBrewer)
library(ggnewscale)
library(ggraph)
library(igraph)
library(forcats)

################################# GENE ONTOLOGY ANALYSIS DEGs WHOLE KIDNEY WT vs KO ###########################################################################################
# DEGs from whole kidney analysis (Supplementary Table S15)
# thresholds:
# p-value < 0.05
# ajusted p-value < 0.05
# foldchange < - 1.3
# Output: 237 genes with decreased expression in Wk KO compared to WK WT

# Data import
setwd("./Input") # Replace with full path
d <- DESeq2_WK_dn_padj

## feature 1: numeric vector
geneList <- d[,2]

## feature 2: named vector
names(geneList) <- as.character(d[,1])

## feature 3: decreasing order
geneList <- sort(geneList, decreasing = TRUE)
head(geneList)
View(geneList)


# Enrichemnt analysis
egoBP <- enrichGO(gene          = names(geneList),
                OrgDb         = org.Mm.eg.db,
                keyType       = "SYMBOL",
                ont           = "BP",
                pAdjustMethod = "fdr",
                pvalueCutoff  = 0.05,
                qvalueCutoff  = 0.05,
                minGSSize     = 10)

egoCC <- enrichGO(gene          = names(geneList),
                  OrgDb         = org.Mm.eg.db,
                  keyType       = "SYMBOL",
                  ont           = "CC",
                  pAdjustMethod = "fdr",
                  pvalueCutoff  = 0.05,
                  qvalueCutoff  = 0.05,
                  minGSSize     = 10)

egoMF <- enrichGO(gene          = names(geneList),
                  OrgDb         = org.Mm.eg.db,
                  keyType       = "SYMBOL",
                  ont           = "MF",
                  pAdjustMethod = "fdr",
                  pvalueCutoff  = 0.05,
                  qvalueCutoff  = 0.05,
                  minGSSize     = 10)

## Save 
write.table(egoBP, "GO-BP_IMCD3cells_negfc_DESeq2_minCount5_dn.txt", sep = "\t", row.names = TRUE) # SUPPLEMENTARY TABLE S16
write.table(egoCC, "GO-CC_IMCD3cells_negfc_DESeq2_minCount5_dn.txt", sep = "\t", row.names = TRUE)
write.table(egoMF, "GO-MF_IMCD3cells_negfc_DESeq2_minCount5_dn.txt", sep = "\t", row.names = TRUE)











